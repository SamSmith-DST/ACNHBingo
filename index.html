<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACNH Villager Bingo</title>
    <style>
        :root {
            --card-default: rgba(240, 240, 240, 0.9);
            --card-text: #444;
            --accent-green: #79c9a1; 
            --marked-text: #ffffff;
            --border-color: #bbbbbb;
            --panel-bg: rgba(233, 228, 208, 0.95);
        }
        
        body, html { height: 100%; margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
        body {
            background-image: url('https://i.redd.it/y5mzeig307b41.png');
            background-size: cover; background-position: center; background-repeat: no-repeat;
            display: flex; flex-direction: column; align-items: center; color: #5d4a3e;
        }

        h1 { 
            color: #4b8b6a; margin: 1.5vh 0; background: white; 
            padding: 5px 30px; border-radius: 50px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            font-size: clamp(1.2rem, 3.5vh, 1.8rem); flex-shrink: 0;
        }

        .main-container {
            display: flex; flex-direction: row; width: 98vw; height: 82vh;
            gap: 20px; align-items: center; justify-content: center;
        }

        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; height: 100%; aspect-ratio: 1 / 1; }

        .villager-card {
            background: var(--card-default); border: 2px solid var(--border-color);
            border-radius: 12px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
            padding: 8px; cursor: pointer; user-select: none;
            transition: all 0.2s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            backdrop-filter: blur(4px); overflow: hidden; position: relative;
        }
        
        .villager-card.marked {
            background-color: var(--accent-green); border-color: #5db689;
            color: var(--marked-text); backdrop-filter: none;
        }

        .villager-img { 
            height: 65%; width: auto; object-fit: contain; 
            pointer-events: none; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1));
        }

        .villager-name { font-weight: bold; font-size: clamp(0.6rem, 1.8vh, 1.1rem); margin-top: 4px; }
        
        .free-space { 
            background-color: rgba(200, 200, 200, 0.8); 
            border: 3px dashed #888;
            color: #666;
        }
        .free-space.marked { background-color: var(--accent-green); border: 3px solid #5db689; color: white; }
        .free-space-text { font-size: clamp(0.8rem, 2.5vh, 1.5rem); font-weight: 900; }
        
        .sidebar { width: 260px; height: 100%; display: flex; flex-direction: column; flex-shrink: 0; }
        .exclusion-panel {
            background: var(--panel-bg); padding: 15px; border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.3); display: flex;
            flex-direction: column; height: 100%; box-sizing: border-box;
        }

        .exclusion-panel input { padding: 10px; border-radius: 8px; border: 2px solid #555; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        .chip-container { display: flex; flex-direction: column; gap: 8px; overflow-y: auto; flex-grow: 1; }
        .chip { background: #d9534f; color: white; padding: 10px; border-radius: 8px; font-size: 0.9em; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .controls { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        
        button { padding: 12px; border: none; border-radius: 20px; color: white; font-size: 0.9rem; cursor: pointer; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .btn-refresh { background-color: #4b8b6a; }
        .btn-reset { background-color: #666; }

        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>
    <h1>ACNH Villager Bingo</h1>

    <div class="main-container">
        <div id="villagerGrid" class="grid"></div>
        <div class="sidebar">
            <div class="exclusion-panel">
                <strong>Exclusions:</strong>
                <input type="text" id="excludeInput" placeholder="Name + Enter..." list="villagerNames">
                <datalist id="villagerNames"></datalist>
                <div id="chipContainer" class="chip-container"></div>
                <div class="controls">
                    <button class="btn-refresh" onclick="confirmNewBoard()">New Board</button>
                    <button class="btn-reset" onclick="confirmFullReset()">Reset All</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const allVillagers = ["Ace", "Admiral", "Agent S", "Agnes", "Al", "Alfonso", "Alice", "Alli", "Amelia", "Anabelle", "Anchovy", "Angus", "Anicotti", "Ankha", "Annalisa", "Annalise", "Antonio", "Apollo", "Apple", "Astrid", "Audie", "Aurora", "Ava", "Avery", "Axel", "Azalea", "Baabara", "Bam", "Bangle", "Barold", "Bea", "Beardo", "Beau", "Becky", "Bella", "Benedict", "Benjamin", "Bertha", "Bettina", "Bianca", "Biff", "Big Top", "Bill", "Billy", "Biskit", "Bitty", "Blaire", "Blanche", "Bluebear", "Bob", "Bonbon", "Bones", "Boomer", "Boone", "Boots", "Boris", "Boyd", "Bree", "Broccolo", "Broffina", "Bruce", "Bubbles", "Buck", "Bud", "Bunnie", "Butch", "Buzz", "Cally", "Camofrog", "Canberra", "Candi", "Carmen", "Caroline", "Carrie", "Cashmere", "Celia", "Cephalobot", "Cesar", "Chadder", "Chai", "Charlise", "Cheri", "Cherry", "Chevre", "Chief", "Chops", "Chow", "Chrissy", "Claude", "Claudia", "Clay", "Cleo", "Clyde", "Coach", "Cobb", "Coco", "Cole", "Colton", "Cookie", "Cousteau", "Crackle", "Croque", "Cube", "Curlos", "Curly", "Curt", "Cyd", "Cyrano", "Daisy", "Deena", "Deirdre", "Deli", "Derwin", "Diana", "Diva", "Dizzy", "Dobie", "Doc", "Dom", "Dora", "Dotty", "Drago", "Drake", "Drift", "Ed", "Egbert", "Elise", "Ellie", "Eloise", "Elvis", "Erik", "Etoile", "Eugene", "Eunice", "Faith", "Fang", "Fauna", "Felicity", "Filbert", "Fillip", "Finley", "Flick", "Flora", "Flurry", "Francine", "Frank", "Freckles", "Freya", "Friga", "Frita", "Frobert", "Fuchsia", "Gabi", "Gala", "Gaston", "Gayle", "Genji", "Gigi", "Gladys", "Gloria", "Goldie", "Gonzo", "Goose", "Graham", "Greta", "Grizzly", "Groucho", "Gruff", "Gwen", "Hamlet", "Hamphrey", "Hans", "Harry", "Hazel", "Henry", "Hippeux", "Hopkins", "Hopper", "Hornsby", "Huck", "Hugh", "Iggly", "Ike", "Ione", "Jacob", "Jacques", "Jambette", "Jay", "Jeremiah", "Jitters", "Joey", "Judy", "Julia", "Julian", "June", "Kabuki", "Katt", "Keaton", "Ken", "Ketchup", "Kevin", "Kid Cat", "Kidd", "Kiki", "Kitt", "Kitty", "Klaus", "Knox", "Kody", "Kyle", "Leonardo", "Leopold", "Lily", "Limberg", "Lionel", "Lobo", "Lolly", "Lopez", "Louie", "Lucha", "Lucky", "Lulu", "Lyman", "Mac", "Maddie", "Maelle", "Maggie", "Mallary", "Maple", "Marcel", "Marcie", "Margie", "Marina", "Marshal", "Mary", "Mathilda", "Megan", "Melba", "Merengue", "Merry", "Midge", "Mint", "Mira", "Miranda", "Mitzi", "Moe", "Molly", "Monique", "Monty", "Moose", "Mott", "Muffy", "Murphy", "Nan", "Nana", "Naomi", "Nate", "Nibbles", "Norma", "O'Hare", "Octavian", "Olaf", "Olive", "Olivia", "Opal", "Ozzie", "Pancetti", "Pango", "Paolo", "Papi", "Pashmina", "Pate", "Patty", "Paula", "Peaches", "Peanut", "Pecan", "Peck", "Peewee", "Peggy", "Pekoe", "Penelope", "Petri", "Phoebe", "Pierce", "Pietro", "Pinky", "Piper", "Pippy", "Plucky", "Pompom", "Poppy", "Portia", "Prince", "Puck", "Puddles", "Pudge", "Punchy", "Purrl", "Queenie", "Quillson", "Quinn", "Raddle", "Rasher", "Raymond", "Ren√©e", "Reneigh", "Rex", "Rhonda", "Ribbot", "Ricky", "Rilla", "Rizzo", "Roald", "Robin", "Rocco", "Rocket", "Rod", "Rodeo", "Rodney", "Rolf", "Rooney", "Rory", "Roscoe", "Rosie", "Rowan", "Ruby", "Rudy", "Sasha", "Sally", "Samson", "Sandy", "Sandy", "Savannah", "Scoot", "Shari", "Sheldon", "Shep", "Sherb", "Shino", "Simon", "Skye", "Sly", "Snake", "Snooty", "Soleil", "Sparro", "Spike", "Spork", "Sprinkle", "Sprocket", "Static", "Stella", "Sterling", "Stinky", "Stitches", "Stu", "Sydney", "Sylvana", "Sylvia", "T-Bone", "Tabby", "Tad", "Tammi", "Tammy", "Tangy", "Tank", "Tasha", "Teddy", "Tex", "Tia", "Tiansheng", "Tiffany", "Timbra", "Tipper", "Tom", "Toby", "Truffles", "Tucker", "Tutu", "Twiggy", "Tybalt", "Ursala", "Velma", "Vesta", "Vic", "Victoria", "Violet", "Vivian", "Vladimir", "Wade", "Walker", "Walt", "Wart Jr.", "Weber", "Wendy", "Whitney", "Whitlow", "Willow", "Winnie", "Wolfgang", "Yuka", "Zell", "Zucker"];

        let state = { excluded: [], grid: [] };

        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resizeCanvas; resizeCanvas();

        function createConfetti(x, y, amount = 25) {
            const colors = ['#79c9a1', '#ffffff', '#d9534f', '#fbc02d', '#4b8b6a'];
            for (let i = 0; i < amount; i++) {
                particles.push({
                    x, y, color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 7 + 3, vx: (Math.random() - 0.5) * 14,
                    vy: (Math.random() - 0.5) * 14 - 5, gravity: 0.25, life: 1.0
                });
            }
        }

        function updateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, i) => {
                p.vy += p.gravity; p.x += p.vx; p.y += p.vy; p.life -= 0.015;
                if (p.life <= 0) particles.splice(i, 1);
                ctx.globalAlpha = p.life; ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.size, p.size);
            });
            requestAnimationFrame(updateConfetti);
        }
        updateConfetti();

        function checkBingo() {
            const size = 5;
            const marked = state.grid.map(c => c.marked);
            let foundIndices = new Set();
            for (let r = 0; r < size; r++) {
                let row = [0,1,2,3,4].map(i => r * size + i);
                if (row.every(idx => marked[idx])) row.forEach(idx => foundIndices.add(idx));
            }
            for (let c = 0; c < size; c++) {
                let col = [0,1,2,3,4].map(i => i * size + c);
                if (col.every(idx => marked[idx])) col.forEach(idx => foundIndices.add(idx));
            }
            const diag1 = [0, 6, 12, 18, 24], diag2 = [4, 8, 12, 16, 20];
            if (diag1.every(idx => marked[idx])) diag1.forEach(idx => foundIndices.add(idx));
            if (diag2.every(idx => marked[idx])) diag2.forEach(idx => foundIndices.add(idx));
            return foundIndices;
        }

        function init() {
            const saved = localStorage.getItem('acnh_bingo_final_vVillagerImages');
            if (saved) { state = JSON.parse(saved); renderAll(); } 
            else { generateNewGrid(); }
            const datalist = document.getElementById('villagerNames');
            allVillagers.forEach(v => {
                let opt = document.createElement('option'); opt.value = v; datalist.appendChild(opt);
            });
        }

        function save() { localStorage.setItem('acnh_bingo_final_vVillagerImages', JSON.stringify(state)); }

        const input = document.getElementById('excludeInput');
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const val = allVillagers.find(v => v.toLowerCase() === input.value.trim().toLowerCase());
                if (val && !state.excluded.includes(val) && state.excluded.length < 10) {
                    state.excluded.push(val); input.value = ''; generateNewGrid();
                }
            }
        });

        function generateNewGrid() {
            const pool = allVillagers.filter(v => !state.excluded.includes(v));
            const shuffled = [...pool].sort(() => 0.5 - Math.random()).slice(0, 24);
            state.grid = []; let vIdx = 0;
            for (let i = 0; i < 25; i++) {
                if (i === 12) state.grid.push({ name: 'FREE SPACE', marked: true, isFree: true });
                else { state.grid.push({ name: shuffled[vIdx], marked: false, isFree: false }); vIdx++; }
            }
            save(); renderAll();
        }

        function renderAll() {
            const container = document.getElementById('chipContainer');
            container.innerHTML = '';
            state.excluded.forEach((v, idx) => {
                const chip = document.createElement('div');
                chip.className = 'chip';
                chip.innerHTML = `<span>${v}</span><span>‚úï</span>`;
                chip.onclick = () => { state.excluded.splice(idx, 1); generateNewGrid(); };
                container.appendChild(chip);
            });

            const gridDiv = document.getElementById('villagerGrid');
            gridDiv.innerHTML = '';
            state.grid.forEach((cell, idx) => {
                const card = document.createElement('div');
                card.className = 'villager-card';
                if (cell.isFree) card.classList.add('free-space');
                if (cell.marked) card.classList.add('marked');

                if (cell.isFree) {
                    card.innerHTML = `<div class="free-space-text">FREE<br>SPACE</div>`;
                } else {
                    // Correct Folder Path: Villager Images/Villager Name/Photo Image.png
                    const parentFolder = encodeURIComponent("Villager Images");
                    const villagerFolder = encodeURIComponent(cell.name);
                    const photoName = encodeURIComponent("Photo Image.png");
                    const imgSrc = `${parentFolder}/${villagerFolder}/${photoName}`;

                    card.innerHTML = `
                        <img class="villager-img" src="${imgSrc}" 
                             onerror="console.log('Path fail:', this.src); this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div style="display:none; font-size:2rem;">üçÉ</div>
                        <div class="villager-name">${cell.name}</div>
                    `;
                }

                card.onclick = (e) => {
                    const previouslyMarked = cell.marked;
                    state.grid[idx].marked = !previouslyMarked;
                    if (!previouslyMarked) {
                        const bingoIndices = checkBingo();
                        if (bingoIndices.has(idx)) {
                            bingoIndices.forEach(bIdx => {
                                const rect = gridDiv.children[bIdx].getBoundingClientRect();
                                createConfetti(rect.left + rect.width / 2, rect.top + rect.height / 2, 40);
                            });
                        } else { createConfetti(e.clientX, e.clientY, 15); }
                    }
                    save(); renderAll();
                };
                gridDiv.appendChild(card);
            });
        }

        function confirmNewBoard() { if (confirm("New Board?")) generateNewGrid(); }
        function confirmFullReset() { if (confirm("Full Reset?")) { state.excluded = []; generateNewGrid(); } }
        init();
    </script>
</body>
</html>
